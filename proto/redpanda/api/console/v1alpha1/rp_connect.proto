syntax = "proto3";

package redpanda.api.console.v1alpha1;

import "buf/validate/validate.proto";

// ListConnectPipelinesRequest is the request for listing all Redpanda connect pipelines.
message ListConnectPipelinesRequest {
  // Filter options.
  message Filter {
    // Filter pipelines that start with the provided string in their name.
    string name_prefix = 1 [
      (buf.validate.field).string.max_len = 128,
      (buf.validate.field).string.pattern = "^([a-zA-Z0-9-_]*)$"
    ];

    // Filter pipelines that contain the provided string in their name.
    string name_contains = 2 [
      (buf.validate.field).string.max_len = 128,
      (buf.validate.field).string.pattern = "^([a-zA-Z0-9-_]*)$"
    ];
  }

  // Optional filter.
  optional Filter filter = 1;

  // Page size.
  int32 page_size = 2 [(buf.validate.field).int32 = {
    gte: -1,
    lte: 1000
  }];

  // Value of the next_page_token field returned by the previous response.
  // If not provided, the system assumes the first page is requested.
  string page_token = 3;
}

message ConnectPipeline {
  string name = 1;
  string config = 2;
  State state = 3;
  string input = 4;
  string output = 5;

  enum State {
    STATE_UNSPECIFIED = 0;
    // State is healthy if input and output are successfully connect.
    STATE_HEALTHY = 1;
    // State is unhealthy if either input or output cannot reach their target.
    STATE_UNHEALTHY = 2;
    // State is unassigned when no RP Connect instance has been reporting any
    // status on the pipeline for at least 1 minute.
    STATE_UNASSIGNED = 3;
  }
}

// ListConnectPipelinesResponse is the response for ListConnectPipelines.
message ListConnectPipelinesResponse {
  // The pipelines
  repeated ConnectPipeline pipelines = 1;

  // Token to retrieve the next page.
  string next_page_token = 2;
}

// GetConnectPipelineRequest is the request to retrieve a pipeline by name.
message GetConnectPipelineRequest {
  string name = 1 [
    (buf.validate.field).string.min_len = 1,
    (buf.validate.field).string.max_len = 255,
    (buf.validate.field).string.pattern = "^[a-zA-Z0-9._\\-]*$"
  ];
}

// GetConnectPipelineResponse returns the configuration and metadata for the
// requested pipeline.
message GetConnectPipelineResponse {
  ConnectPipeline pipeline = 1;
}

service RedpandaConnectService {
  // ListConnectPipelines lists all the connect pipelines based on optional filter.
  rpc ListConnectPipelines(ListConnectPipelinesRequest) returns (ListConnectPipelinesResponse) {}
  // GetConnectPipeline retrieves exactly one pipeline by its name.
  rpc GetConnectPipeline(GetConnectPipelineRequest) returns (GetConnectPipelineResponse) {}
}
